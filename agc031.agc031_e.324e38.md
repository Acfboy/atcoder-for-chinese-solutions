---
title: "AGC031_E_solution.md"
tags: []
author: ""
created: ""
---

[AGC031E](https://atcoder.jp/contests/agc031/tasks/agc031_e)

<!-- more -->

瞪了一会，想到大概是一个网络流。

对于这种整数坐标的常见套路就是将 $x$ 和 $y$ 分别放在二分图的两端，中间的每条线代表一颗宝石，一个点可以被多条选出的点包含，最后要最大化选出的边的总权值。由于坐标和宝石的个数都很少，点数边数可以接受。

![](https://cdn.jsdelivr.net/gh/shmilyty/img@main/data/1.png)

如何将限制建进图里？我一开始把每一个限制转化成二分图里左边（或右边）连续一个区间里所有点被选的总次数不能超过 $b$ ，但这样有点难办（如果任意两个区间要么没有交集要么嵌套大概是能做的），但是原问题中区间总是一个前缀或一个后缀，因此有可能是有交集但不嵌套。想了半天还是没有解决方案，于是只好爬去看题解。

还是要利用前缀和后缀这一特殊条件，枚举选出的点数，假设当前选出了 $k$ 个点，按照 $x$ 和 $y$ 分别从小到大排列，那么 $x\le a$ 的点最多有 $b$ 个，等价于按照 $x$ 从小到大排列，第 $b+1$ 个点的 $x$ 值大于 $a$； $x\ge a'$ 的点最多有 $b'$ 个，等价于第 $k-b'$ 个点的 $x$ 值小于 $a$，那么就可以将这 $k$ 个点每个点的 $x$ 值的范围求出来，可以利用这个来建图。同样，可以将 $k$ 个点按照 $y$ 值从小到大排列，用相同的做法求出每个点的 $y$ 值的范围。

![](https://cdn.jsdelivr.net/gh/shmilyty/img@main/data/2.png)

具体实现：

- 枚举选出的点数 $k$，将 $S$ 向左侧的 $[1,k]$ 各连一条容量为 $1$，价值为 $0$ 的边，将右侧的 $[1,k]$ 向 $T$ 连一条容量为 $1$，价值为 $0$ 的边。
- 对于左侧 $[1,k]$ 中每个点，计算出其 $x$ 值的取值范围，将这个点向 $x$ 的相应范围连一条容量为 $1$，价值为 $0$ 的边。
- 对于右侧 $[1,k]$ 中每个点，计算出其 $y$ 值的取值范围，将 $y$ 的相应范围向这个点连一条容量为 $1$，价值为 $0$ 的边。
- 对于每颗宝石，将对应的 $x,y$ 连一条容量为 $1$，价值为 $v$ 的边。
- 用这个图的**最大费用最大流**更新答案。

时间复杂度： $\mathcal{O}(n^2k^2)$ 

咋算？，我母鸡啊。

---

总结：

一开始之所以考虑将限制转化区间总次数，是因为可以利用容量对一个区间的总次数进行约束，但是这是一个单向的转化，导致无法处理两个区间相交且不嵌套的情况。通过这一题，又掌握了一个网络流的技巧：可以尝试将约束转化为一个范围。

但这本质上还是限制了区间的总次数，只不过是特殊化了而已：这个总次数固定为 $1$，且区间与区间不会互相影响。

---

bonus：我在前面提出的问题

![](https://cdn.jsdelivr.net/gh/shmilyty/img@main/data/3.png)

(by ShmilyTY)

